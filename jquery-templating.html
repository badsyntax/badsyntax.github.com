<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
	<title>jQuery Templating</title>
</head>
<body>

	<div id="html-content">
		<p>
			Hello, my name is <em>${name}</em>. I'm originally from ${origin} but am currently living in ${location}. 
		</p>
		<p>
			I'm a ${occupation}, and I really enjoy working with ${language}.
		</p>
		<p>
			I use ${phpframework} for my backend framework, and ${javascriptlibrary} 
			and ${javascriptframework} for all front-end interface work.
		</p>
	</div>
	<div>
		<button>
			Render it!
		</button>
	</div>

	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4/jquery.min.js"></script>

	<script type="text/javascript">
		//<![CDATA[
		$.fn.render = function(data){

			data = data || {};

			function walkTextNodes(textNodeCallback){

				(this.nodeType === 3 && textNodeCallback) && textNodeCallback.call(this);

				$.each(this.childNodes, function(){
					walkTextNodes.call(this, textNodeCallback);
				});	
			}	

			function replace(key){
				this.nodeValue = this.nodeValue.replace(new RegExp('\\$\{' + key + '\}', 'g'), data[key]);
			}	

			return this.each(function(){

				walkTextNodes.call(this, function(){

					var nodeValue = this.nodeValue.replace(new RegExp('\\n', 'g'), ''); // is this a problem?

					while(match = /\{(.*?)\}/g.exec(nodeValue))
						(data[match[1]]) && replace.call(this, match[1]);
				});	
			});	
		}; 
		//]]>
	</script>

	<script type="text/javascript">
		//<![CDATA[

		var data = {
			name: 'Richard Willis',
			origin: 'South Africa',
			location: 'London',
			occupation: 'Web Developer',
			language: 'Javascript',
			phpframework: 'Kohana', 
			javascriptlibrary: 'jQuery',
			javascriptframework: 'jQuery UI'
		};

		$('button').click(function(){
			$('#html-content').render(data);
		});

		//]]>
	</script>
</body>
</html>
