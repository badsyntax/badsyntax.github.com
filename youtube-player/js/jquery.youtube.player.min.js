/*
 * jquery.youtube.min.js - a jquery youtube player
 * Copyright (c) 2010 Richard Willis
 * MIT license	: http://www.opensource.org/licenses/mit-license.php
 * Project	: http://github.com/badsyntax/jquery-youtube-player
 * Contact	: willis.rh@gmail.com | badsyntax.co.uk
 */
(function(d,h,l){function j(a,c,b){this._pluginName=b;this.options=d.extend({width:425,height:356,swfobject:h.swfobject,playlist:{},showPlaylist:1,randomStart:1,autoStart:0,repeat:0,shuffle:0,updateHash:0,playlistHeight:5,videoParams:{allowfullscreen:"true",allowScriptAccess:"always"},toolbar:"play,pause,prev,next,shuffle,repeat,mute,playlistToggle"},c);this.element=d(a);this.init()}d.fn.player=function(a){var c=arguments;return this.each(function(){var b=d.data(this,"jquery-youtube-player");if(b&& b[a])b[a].apply(b,Array.prototype.slice.call(c,1));else if(!b&&(typeof a==="object"||!a))d.data(this,"jquery-youtube-player",new j(this,a,"jquery-youtube-player"))})};j.prototype={state:-1,timer:{},router:{},videoIds:[],elements:{},init:function(){this.element.addClass("ui-widget");this.elements.player=this.element;this.elements.playerVideo=this.element.find(".youtube-player-video");this.elements.playerObject=this.element.find(".youtube-player-object");this.elements.playerObjectClone=this.elements.playerObject.clone(); this.keys={video:0};this.uniqueId(this.elements.playerObject[0],"youtube-player-");this.loadPlaylist()},initRouter:function(){var a=this,c=h.location.hash.replace(/.*?#\//,"");this.router={hash:c,actions:/\//.test(c)?c.split("/"):["v"],updateHash:function(){if(a.options.updateHash)h.location.hash="/"+a.router.actions[0]+"/"+a.options.playlist.videos[a.keys.video].id}};switch(this.router.actions[0]){case "v":this.keys.video=this.router.actions[1]?d.inArray(this.router.actions[1],this.videoIds):this.keys.video; break;case "p":this.keys.video=d.inArray(this.router.actions[1],this.videoIds);this.keys.play=1}return this},uniqueId:function(a,c){c=c||"random-";var b;do b=c+Math.floor(Math.random()*101).toString();while(l.getElementById(b));if(a)a.id=b;return b},trigger:function(a,c,b){var e=typeof c;if(e==="string"&&this.options[c]&&d.isFunction(this.options[c]))this.options[c].apply(a,b);else e==="function"&&c.apply(a,b)},loadPlaylist:function(a,c){if(a)this.options.playlist=a;this.getPlaylistData(function(){this.keys.video= this.options.randomStart?this.randomVideo():0;if(this.youtubePlayer){this.createPlaylist();this.cueVideo();this.showPlaylist()}else this.createElements().bindPlayerEvents().bindYoutubeEvents().initRouter();this.trigger(this,c)},function(){this.elements.playerObject.html("There was an error loading the playlist.").removeClass("playlist-loading")})},getPlaylistData:function(a,c){var b=this,e=this.options.playlist;if(e.user||e.playlist){var g=function(i){if(i){b.options.playlist={title:i.feed.title.$t, id:e,videos:[]};d.each(i.feed.entry,function(m,k){b.options.playlist.videos.push({id:k.link[0].href.replace(/^[^v]+v.(.{11}).*/,"$1"),title:k.title.$t})});b.elements.playerObject.fadeOut(180,function(){a.call(b)})}else c.call(b)};d.ajax({type:"GET",url:e.user?"http://gdata.youtube.com/feeds/base/users/"+e.user+"/uploads?v=2&orderby=published&client=ytapi-youtube-profile&max-results=50":"http://gdata.youtube.com/feeds/api/playlists/"+e.playlist,data:{alt:"json"},dataType:"json",error:function(){c.call(b)}, success:function(){g.apply(b,arguments)}})}else a.call(b)},updatePlaylist:function(){var a=this;this.elements.playlist.find("li").removeClass("ui-state-active").each(function(c){if(a.options.playlist.videos[a.keys.video].id==d(this).data("video").id){var b=d(this).addClass("ui-state-active").outerHeight();a.elements.scrollbar.pos=c*b-Math.floor(a.options.playlistHeight/2)*b;a.elements.playlistScroller.scrollTop(a.elements.scrollbar.pos);return false}})},showPlaylist:function(){this.elements.playlistContainer.show(); var a=this.elements.playlist.height(),c=this.elements.playlist.find("li:first").outerHeight()*this.options.playlistHeight;this.elements.playlistContainer.hide();this.elements.playlistScroller.height(c<a?c:a);this.options.showPlaylist&&this.elements.playlistContainer.animate({height:"toggle",opacity:"toggle"},550)},bindYoutubeEvents:function(){var a=this;this.youtubePlayerEvents={ready:function(){a.youtubePlayer=a.elements.player.find("object:first").get(0);a.youtubePlayer.addEventListener("onStateChange", "_youtubeevents");a.youtubePlayer.addEventListener("onError","_youtubeevents");a.cueVideo();a.elements.toolbar.container.animate({opacity:1},400,function(){a.trigger(a,"onReady",arguments)});a.showPlaylist();a.keys.play&&a.playVideo()},videoPlay:function(){a.updatePlaylist();a.router.updateHash();f.play.element.data("state",1);a.elements.toolbar.updateStates();a.elements.infobar.css({opacity:0});a.updateInfo(320);a.trigger(this,"onVideoPlay",arguments)},videoEnded:function(){a.options.repeat&&a.nextVideo()}, error:function(c){switch(c){case 100:msg="This video has been removed from Youtube.";break;case 101:case 150:msg="This video does not allow playback outside of Youtube.";break;default:msg="Unknown error"}a.trigger(this,"onError",[msg]);alert("Sorry, there was an error loading this video. "+msg)},videoBuffer:function(){a.trigger(this,"onBuffer",arguments)}};h.onYouTubePlayerReady=function(){a.youtubeEventHandler(9)};h._youtubeevents=function(c){a.youtubeEventHandler(c)};return this},bindPlayerEvents:function(){var a= this;this.elements.playerVideo.unbind("mouseenter.player mouseleave.player").bind("mouseenter.player",function(){a.updateInfo()}).bind("mouseleave.player",function(){a.hideInfo()});return this},youtubeEventHandler:function(a){if(a!=this.state)switch(this.state=a){case 0:this.youtubePlayerEvents.videoEnded();break;case 1:this.youtubePlayerEvents.videoPlay();break;case 3:this.youtubePlayerEvents.videoBuffer();break;case 100:case 101:case 150:this.youtubePlayerEvents.error(a);break;case 9:this.youtubePlayerEvents.ready()}}, loadVideo:function(a,c){this.elements.infobar.stop().css({opacity:0});if(a){this.options.playlist.videos=c?[{id:a,title:c}]:[];this.createPlaylist();this.showPlaylist();this.keys.video=d.inArray(a,this.videoIds)}this.youtubePlayer.loadVideoById(a||this.options.playlist.videos[this.keys.video].id,0);this.router.updateHash()},pauseVideo:function(){this.youtubePlayer.pauseVideo()},shufflePlaylist:function(){this.randomVideo();this.playVideo()},muteVideo:function(a){a.element.data("state")?this.youtubePlayer.mute(): this.youtubePlayer.unMute()},repeat:function(){this.options.repeat=1},playVideo:function(){this.youtubePlayer.playVideo()},cueVideo:function(a){return this.youtubePlayer.cueVideoById(a||this.options.playlist.videos[this.keys.video].id,0)},randomVideo:function(){this.keys.video=Math.floor(Math.random()*this.options.playlist.videos.length);return this.keys.video},prevVideo:function(){if(this.keys.video>0){this.keys.video--;f.play.element.data("state",0);this.loadVideo();this.playVideo()}},nextVideo:function(){if(this.keys.video< this.options.playlist.videos.length-1){if(this.options.shuffle)this.randomVideo();else this.keys.video++;f.play.element.data("state",0);this.loadVideo();this.playVideo()}},playlistToggle:function(){this.elements.playlistContainer.find("li").length&&this.elements.playlistContainer.animate({height:"toggle",opacity:"toggle"},550)},fullscreen:function(){this.youtubePlayer.setSize(900,900)},updateInfo:function(a,c){var b=this;if((f.play.element.data("state")||f.pause.element.data("state"))&&this.elements.infobar.css("opacity")< 1){clearTimeout(this.timer.hideInfo);this.timer.showInfo=setTimeout(function(){b.elements.infobar.stop(true,true).css({opacity:0}).html(c||(b.options.playlist.videos[b.keys.video]?b.options.playlist.videos[b.keys.video].title:"")).unbind("click").click(function(){h.open(b.youtubePlayer.getVideoUrl())}).animate({opacity:1},180,function(){b.timer.hideInfo=setTimeout(function(){b.hideInfo()},6E3)})},a||0)}},hideInfo:function(){clearTimeout(this.timer.hideInfo);clearTimeout(this.timer.showInfo);this.elements.infobar.stop(true, true).animate({opacity:0},120)},createElements:function(){return this.createPlayer().createToolbar().createInfobar().createPlaylist()},createPlayer:function(){this.elements.player.width(this.options.width);this.elements.playerVideo.height(this.options.height);this.options.swfobject.embedSWF("http://www.youtube.com/apiplayer?enablejsapi=1&version=3&playerapiid=youtube&hd=1&showinfo=0",this.elements.playerObject[0].id,"100%","100%","8",null,null,this.options.videoParams);return this},createToolbar:function(){var a= this;this.elements.toolbar={container:d('<ul class="youtube-player-toolbar ui-widget ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">').css("opacity",0),updateStates:function(){d.each(a.options.toolbar.split(","),function(c,b){var e=f[b];if(!e)return true;e.element.removeClass("ui-state-active");e.element.data("state")&&(e.toggle||e.toggleButton&&f[e.toggleButton])&&e.element.addClass("ui-state-active")})}};d.each(this.options.toolbar.split(","),function(c,b){var e=f[b];if(!e)return true; f[b].element=d('<li class="ui-state-default ui-corner-all">').append('<span class="ui-icon '+e.icon+'">').attr("title",e.text).data("button",e).bind("mouseenter mouseleave",function(){d(this).toggleClass("ui-state-hover")}).click(function(){var g=d(this).data("button"),i=d(this).data("state");d(this).data("state",i&&g.toggle?0:1);g.toggleButton&&f[g.toggleButton].element.data("state",0);a.elements.toolbar.updateStates();g.action.call(a,g)}).appendTo(a.elements.toolbar.container)});this.elements.playerVideo.after(this.elements.toolbar.container); return this},createInfobar:function(){this.elements.infobar=d("<div>").addClass("youtube-player-infobar ui-widget-content ui-corner-all").css("opacity",0);this.elements.playerVideo.prepend(this.elements.infobar);return this},createPlaylist:function(){function a(){b.elements.scrollbar.pos=b.elements.scrollbar.pos>b.elements.playlist.find("li:first").height()?b.elements.scrollbar.pos-b.elements.playlist.find("li:first").height():0;b.elements.playlistScroller.scrollTop(b.elements.scrollbar.pos)}function c(){b.elements.scrollbar.pos= b.elements.scrollbar.pos<b.elements.playlist.outerHeight()-b.elements.playlistScroller.outerHeight()?b.elements.scrollbar.pos+b.elements.playlist.find("li:first").height():b.elements.scrollbar.pos;b.elements.playlistScroller.scrollTop(b.elements.scrollbar.pos)}var b=this;this.elements.playlistScroller=d('<div class="youtube-player-playlist-scroller">');d.fn.mousewheel&&this.elements.playlistScroller.unbind().bind("mousewheel",function(e,g){g>0?a():c()});this.elements.playlistContainer=this.elements.playlistContainer|| d("<div>").addClass("youtube-player-playlist-container ui-widget-content ui-corner-all");this.elements.playlistContainer.empty();this.elements.playlist=d("<ol>").addClass("youtube-player-playlist ui-helper-reset");this.elements.scrollbar={bar:d("<div>").addClass("youtube-player-playlist-scrollbar ui-widget ui-widget-content ui-corner-all").appendTo(this.elements.playlistContainer),up:d("<span>").addClass("youtube-player-playlist-scrollbar-up ui-icon ui-icon-circle-triangle-n").click(function(){a()}).appendTo(this.elements.playlistContainer), down:d("<span>").addClass("youtube-player-playlist-scrollbar-down ui-icon ui-icon-circle-triangle-s").click(function(){c()}).appendTo(this.elements.playlistContainer),pos:0};this.elements.playlist.empty();this.videoIds=[];d.each(this.options.playlist.videos,function(){b.videoIds.push(this.id);d("<li>").data("video",this).append(this.title).addClass("ui-state-default").bind("mouseenter mouseleave",function(){d(this).toggleClass("ui-state-hover")}).click(function(){b.keys.video=d.inArray(d(this).data("video").id, b.videoIds);f.play.element.data("state",0);b.updatePlaylist();b.cueVideo();b.playVideo()}).appendTo(b.elements.playlist)});this.elements.playerVideo.after(this.elements.playlistContainer.append(this.elements.playlistScroller.append(this.elements.playlist)));return this},destroy:function(){this.element.removeClass("ui-widget").removeAttr("style");this.elements.playerVideo.removeAttr("style");this.elements.infobar.remove();this.elements.playlistContainer.remove();this.elements.toolbar.container.remove(); this.options.swfobject.removeSWF(this.elements.playerObject[0].id);this.elements.playerObjectClone.appendTo(this.elements.playerVideo);d.removeData(this.element[0],this._pluginName)}};var f={play:{text:"Play",icon:"ui-icon-play",toggleButton:"pause",action:function(){this.playVideo()}},pause:{text:"Pause",icon:"ui-icon-pause",toggleButton:"play",action:function(){this.pauseVideo()}},prev:{text:"Prev",icon:"ui-icon-seek-prev",action:function(){this.prevVideo()}},next:{text:"Next",icon:"ui-icon-seek-next", action:function(){this.nextVideo()}},shuffle:{text:"Shuffle/Random",icon:"ui-icon-shuffle",toggle:1,action:function(){this.shufflePlaylist()}},repeat:{text:"Repeat playlist",icon:"ui-icon-refresh",toggle:1,action:function(){this.repeat()}},mute:{text:"Mute",icon:"ui-icon-volume-on",toggle:1,action:function(a){this.muteVideo(a)}},fullscreen:{text:"Full screen",icon:"ui-icon-arrow-4-diag",toggle:1,action:function(){this.fullscreen()}},playlistToggle:{text:"Toggle playlist",icon:"ui-icon-script",action:function(){this.playlistToggle()}}}})(window.jQuery, window,document);
